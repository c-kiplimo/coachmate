<div class="row">
  <div class="col mt-4" style="margin-left: 5px">
    <h5 class="fw-bold">
      <i class="fas fa-chevron-left pe-5 pt-3 back-icon back" (click)="back()">
        Back</i
      >
    </h5>
  </div>
</div>

<div class="row justify-content-center m-2 p-3">
  <div class="col-md-8">
    <div class="card card-table justify-content-center align-items-center">
      <div class="m-3">
        <h1 class="text-center mb-3">Add session</h1>
      </div>
      <form class="m-3">
        <div class="row justify-content-center">
          <div class="mb-3 col-md-12">
            <label for="sessionname">Select Contract *</label>
            <select class="form-select" id="inputGroupSelect01" (change)="onContractChange($event)" name="type">
              <option value="" disabled selected>Select Contract</option>
              <option *ngFor="let contract of contracts" [value]="contract?.id">
                {{ contract?.coachingTopic }}-{{ contract?.clientFirstName }}
              </option>
            </select>
          </div>

          <div class="mb-3 col-md-12">
            <label for="sessionname">Session Name *</label>
            <input [(ngModel)]="formData.name" type="text" class="form-control" id="name"
              placeholder="Enter Session Name" name="name" />
          </div>

          <div class="mb-3 col-md-12">
            <label class="form-group-text" for="clientType">Session Type *</label>
          </div>
          <div class="mb-3 col-md-12">
            <input class="form-check-input m-2 custom-radio-input" type="radio" name="sessionType"
              id="flexRadioDefault1" value="INDIVIDUAL" [(ngModel)]="formData.sessionType" />
            <label class="form-group-text m-2" for="clientType">INDIVIDUAL</label>
          </div>
          <div class="mb-3 col-md-12">
            <input class="form-check-input m-2 custom-radio-input" type="radio" name="sessionType"
              id="flexRadioDefault2" value="GROUP" [(ngModel)]="formData.sessionType" />
            <label class="form-group-text m-2" for="clientType">GROUP</label>
          </div>
        </div>

        <div class="row justify-content-center">
          <div class="mb-3 col-md-12">
            <label class="form-group-text" for="clientType">Session Venue *</label>
          </div>
          <div class="mb-3 col-md-12">
            <input class="form-check-input m-2 custom-radio-input" type="radio" name="sessionVenue"
              id="flexRadioDefault1" value="VIRTUAL" [(ngModel)]="formData.sessionVenue" />
            <label class="form-group-text m-2" for="clientType">VIRTUAL</label>
          </div>
          <div class="mb-3 col-md-12">
            <input class="form-check-input m-2 custom-radio-input" type="radio" name="sessionVenue"
              id="flexRadioDefault2" value="PHYSICAL" [(ngModel)]="formData.sessionVenue" />
            <label class="form-group-text m-2" for="clientType">PHYSICAL</label>
          </div>
        </div>

        <div class="row justify-content-center">
          <div class="mb-3 col-md-12">
            <label for="inputlastname">Session Details</label>
            <input type="text" class="form-control" [(ngModel)]="formData.sessionDetails" id="inputEmail4"
              placeholder="Enter Session Description" name="sessionDetails" />
          </div>
        </div>

        <div class="row justify-content-center m-2">
          <div class="col-md-12">
            <!-- your-component.component.html -->
            <!-- <div class="inline-calendar-container">
              <ngb-datepicker [(ngModel)]="selectedDate" (dateSelect)="onDateSelect($event)"
                [displayMonths]="displayMonths" [navigation]="navigation" [showWeekNumbers]="showWeekNumbers"
                [outsideDays]="outsideDays">
              </ngb-datepicker>
            </div> -->

            <!--select date from calender-->
            <div class="form-group">
              <label for="date">Select Date & Time that works for you</label>
            </div>

            <div class="calendar">
              <div class="header">
                <button class="btn btn-outline-success" (click)="prevMonth()">Previous</button>
                <h2>{{ currentDate | date: 'MMMM yyyy' }}</h2>
                <button class="btn btn-outline-success" (click)="nextMonth()">Next</button>
              </div>
              <table class="calendar-table">
                <thead>
                  <tr>
                    <th *ngFor="let day of daysOfWeek" class="day-header">{{ day }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let week of weeks" class="week">
                    <ng-container *ngFor="let day of week">
                      <td class="day-cell" [class.empty]="!day" [class.booked]="day && day.bookedCount > 0"
                        [class.disabled]="day && day.bookedCount < 1"
                        (click)="day.bookedCount > 0 ? onDateSelect(day) : null">
                        <div class="date-wrapper">
                          <div class="date">{{ day ? day?.date.slice(-2) : '' }}</div>
                          <div class="booked-count">{{ day?.bookedCount ? day?.bookedCount : '_' }}</div>
                        </div>
                      </td>
                    </ng-container>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Display the selected date if needed -->
            <p *ngIf="formData.sessionDate">Available slots on: {{ formData.sessionDate | date }}</p>

            <!-- title -->
            <!-- <div class="d-flex mt-2">
              <h5 class="m-2">select</h5>
              <h5 class="m-2">Start Time</h5>
              <h5 class="m-2">End Time</h5>
              <h5 class="m-2">Repeating</h5>
              <h5 class="m-2">Date</h5>
            </div> -->

            <div class="donut-wrapper m-3" *ngIf="loading" [@fadeIn]>
              <div class="donut multi"></div>
            </div>

            <div class="d-flex m-2" *ngFor="let availableSlot of slots" (click)="selectedSessionSlot(availableSlot)">

              <div>
                <input class="form-check-input m-2 custom-radio-input" type="radio" name="flexRadioDefault"
                id="flexRadioDefault{{availableSlot.id}}"
                [disabled]="availableSlot?.sessionDate && availableSlot?.sessionDate !== formData.sessionDate" />
         
                <label class="form-check-label m-2 custom-label" for="flexRadioDefault{{availableSlot.id}}">
                  {{ availableSlot?.startTime }} -
                </label>
                <label class="form-check-label m-2 custom-label" for="flexRadioDefault{{availableSlot.id}}">
                  {{ availableSlot?.endTime }}
                  <i class="fa fa-repeat custom-loop-icon" *ngIf="availableSlot?.recurring"></i>
                </label>
                <label class="form-check-label m-2 custom-label" for="flexRadioDefault{{availableSlot.id}}">
                  {{ availableSlot?.sessionDate | date:'EEE, yyyy-MM-dd' }}
                  <i class="fa fa-calendar custom-loop-icon" *ngIf="availableSlot?.sessionDate"></i>
                </label>
              </div>
              
            </div>


          </div>

        </div>

        <button type="submit" (click)="addSession()"
          [disabled]="!formData.name || !formData.sessionSchedules || !formData.sessionDate || !formData.sessionVenue || !formData.sessionType || !formData.sessionDetails || !getContractId"
          class="btn btn-signup mb-3 mt-2  btn-outline-success text-center">
          Create Session
        </button>
      </form>
    </div>
  </div>
</div>
