<div class="row">
  <div class="col-10">
      <h3></h3>
  </div>
  <div class="col-2">
      <app-user></app-user>
  </div>
</div>

<br>
<h5 class="section-title text-center ">Session Details</h5>
<div class="row">
  <div class="col-2">
  </div>
  <div class="col-8">
<div class="container-fluid Client mb-5">
    <div class="container">
      <div class="card details-card">
        <div class="mt-5" class="d-flex justify-content-between flex-wrap"[@fadeIn]>
          <div>
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#editsessionModal
            "
            >
              <i class="fas fa-edit"></i>
              Edit
            </button>
          </div>
          <div class="d-flex">
            <div class="dropdown">
              <a class="btn btn-success dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                data-bs-toggle="dropdown" aria-expanded="false">
                Actions</a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a
                      class="dropdown-item"
                      data-bs-toggle="modal"
                      data-bs-target="#confirmsessionModal"
                      >Confirm</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      data-bs-toggle="modal"
                      data-bs-target="#deliveredsessionModal"
                      >conducted</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      data-bs-toggle="modal"
                      data-bs-target="#cancelsessionModal"
                      >Cancel</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      data-bs-toggle="modal"
                      data-bs-target="#sessionModal"
                      >Reschedule</a
                    >
                  </li>
                </ul>
            </div>
           
          </div>
        </div>
        <div class="session-details" [@fadeIn] >
          <div class="d-flex justify-content-between main-detail">
            <span class="title">Session for:</span>
            <span class="value">{{ sessions.name }}</span>
          </div>
          <div class="client-details" >
            <div class="d-flex justify-content-between">
              <span class="title">Session Date</span>
              <span class="value">{{ sessions.sessionDate }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="title">Client name</span>
              <span class="value">{{ sessions.client.fullName }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="title">Session type</span>
              <span class="value">{{ sessions.sessionType}}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="title">Start Time</span>
              <span class="value">{{ sessions.sessionStartTime}}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="title">End Time</span>
              <span class="value">{{ sessions.sessionEndTime }}</span>
            </div>
            <div class="d-flex justify-content-between">
              <span class="title">Status</span>
              <span class="value">{{ sessions.sessionStatus }}</span>
            </div>
  
            <div class="d-flex justify-content-between">
              <span class="title">Amount paid</span>
              <span class="value">{{ sessions.amountPaid }}</span>
            </div>
        
            <div class="d-flex justify-content-between">
              <span class="title">Session Venue</span>
              <span class="value">{{sessions.sessionVenue}}</span>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
    </div>
  </div>
  <div class="card card-table">
    <div class="tabs-section">
      <button
        class="btn btn-tabs"
        (click)="toggleTab('payments')"
        [ngClass]="{ 'active-tab': currentTab === 'payments' }"
      >
        Payments
      </button>

      <button
        class="btn btn-tabs"
        (click)="toggleTab('notifications')"
        [ngClass]="{ 'active-tab': currentTab === 'notifications' }"
      >
        Notifications
      </button>
      <button
          class="btn btn-tabs"
          (click)="toggleTab('attachments')"
          [ngClass]="{ 'active-tab': currentTab === 'attachments' }"
        >
          Attachments
        </button>
    </div>
    <div class="d-none d-lg-block">
      <div class="text-end mt-2" *ngIf="currentTab === 'payments'" [@fadeIn]>
        <button
          class="btn btn-refresh me-2 btn-success"
          data-bs-toggle="modal"
          data-bs-target="#paymentReminderModal"
          *ngIf="session.sessionBalance > 0"
        >
          <fa-icon [icon]="alertIcon"></fa-icon>
          Remind
        </button>
        <button
          class="btn btn-add"
          class="recordpaybtn"
          data-bs-toggle="modal"
          data-bs-target="#payementFormModal"
        >
          <fa-icon [icon]="addIcon"></fa-icon>
          Record payment
        </button>
      </div>

      <table class="table" *ngIf="currentTab === 'payments'" [@fadeIn]>
        <thead>
          <th colspan="1">session Duration</th>
          <th colspan="1">Payment</th>
          <th colspan="1">Balance</th>
          <th colspan="1">Paid On</th>
          <th colspan="1">Narration</th>
          <th colspan="1">Actions</th>
        </thead>
        <tbody *ngIf="payments?.length" [@fadeIn]>
          <tr *ngFor="let payment of payments">
            <td>{{ payment.session.sessionDuration }}</td>
            <td>{{ payment.amount }}</td>
            <!-- <td>
              <span
                class="badge"
                [ngClass]="{
                  'badge-balance': payment.balanceAfter > '0',
                  'badge-overpaid': payment.balanceAfter < '0',
                  'badge-paid': payment.balanceAfter === 0
                }"
              >
                <span *ngIf="payment.balanceAfter < '0'">Overpaid </span>
                <span *ngIf="payment.balanceAfter === 0"> Fully paid </span>
                <span *ngIf="payment.balanceAfter > '0'">
                  {{ payment.balanceAfter }}
                </span>
              </span>
            </td> -->
            <!-- <td>{{ payment.balanceAfter }}</td> -->

            <td>{{ payment.paidAt | date : "MMM d, y hh:mm a " }}</td>
            <td>{{ payment.narration }}</td>
            <td>
              <div class="d-flex justify-content-around">
                <button
                  class="btn btn-view"
                  (click)="goToItem('payment', payment)"
                >
                  view
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div class=" pay-summary me-3 ">
      <table class="table " *ngIf="currentTab === 'payments'">
        <thead>
          <th colspan="1">Price </th>
          <th colspan="1">Total paid</th>
          <th colspan="1">Balance</th>
          <th colspan="1">Status</th>
        </thead>
        <tbody>
          <td>{{session.sessionDuration}}</td>
          <td>{{session.amountPaid}}</td>
          <td>{{session.sessionBalance}}</td>
          <td>
            <span
            class="mb-1 "
            class="badge"
            [ngClass]="{
              'badge-balance': session.sessionBalance === session.sessionDuration,
               'badge-partial': session.sessionBalance > '0' && session.sessionBalance !== session.sessionDuration, 'badge-overpaid':session.sessionBalance < '0',
               'badge-paid': session.sessionBalance == '0' 
            }"
          >
            <p class="p-0 mb-0" *ngIf="session.sessionBalance > '0' && session.sessionBalance !== session.sessionDuration">
              Partially paid
            </p>
            <p class="p-0 mb-0" *ngIf="session.sessionBalance < '0'">
            Overpaid
            </p>
            <p class="p-0 mb-0" *ngIf="session.sessionBalance == '0'">
             Fully paid
            </p>
            <p class="p-0 mb-0" *ngIf="session.sessionBalance === session.sessionDuration">
              Not paid
             </p>

          </span>
          </td>

        </tbody>
      </table>
    </div>

      <div *ngIf="currentTab === 'payments'" [@fadeIn]>
        <p class="text-muted mt-5" *ngIf="!payments?.length">
          No payments found.
        </p>
      </div>

      <div class="donut-wrapper" *ngIf="searching" [@fadeIn]>
        <div class="donut multi"></div>
      </div>
    </div>

    <div class="show-ms" *ngIf="currentTab === 'payments'" [@fadeIn]>

      <div class="d-flex justify-content-between mt-2 mb-2">
        <p *ngIf="session.sessionBalance <= 0"></p>

        <button
          class="btn btn-refresh me-2"
          data-bs-toggle="modal"
          data-bs-target="#paymentReminderModal"
          *ngIf="session.sessionBalance > 0"
        >
          <fa-icon [icon]="alertIcon"></fa-icon>
          Remind
        </button>
        <button
          class="btn btn-add"
          type="button"
          data-bs-toggle="modal"
          data-bs-target="#payementFormModal"
        >
          <fa-icon [icon]="addIcon"></fa-icon>Payment
        </button>
      </div>
      <div class="donut-wrapper" *ngIf="searching" [@fadeIn]>
        <div class="donut multi"></div>
      </div>
      <div *ngIf="payments?.length">
        <div
          (click)="goToItem('payment', payment)"
          *ngFor="let payment of payments"
          class="listing-item"
        >
          <div class="d-flex justify-content-between mb-1">
            <div>
              <h6>{{ payment.narration | titlecase }}</h6>
              <p class="mb-1">Amount: {{ payment.session.sessionDuration }}</p>
            </div>

            <div>
              <span>
                {{ payment.paidAt | date : "MMM d y" }}
              </span>
              <fa-icon class="m-2" [icon]="rightIcon"> </fa-icon>
              <!-- <p></p> -->
              <p class="mb-1">Paid:{{ payment.amount }}</p>
              <!-- <div
              class="mb-1 "
              class="badge"
              [ngClass]="{
                 'badge-balance': payment.balanceAfter > '0', 'badge-overpaid': payment.balanceAfter < '0',
                 'badge-paid': payment.balanceAfter == 0
              }"
            >
              <p *ngIf="payment.balanceAfter > '0'">
                Bal: {{ payment.balanceAfter }}
              </p>
              <p *ngIf="payment.balanceAfter < '0'">
              Overpaid
              </p>
              <p *ngIf="payment.balanceAfter == '0'">
               Fully paid
              </p>

            </div> -->
            </div>
          </div>
        </div>
        <div class="listing-item pay-summary d-flex justify-content-between">
          <span>
            <p>Price (Excluding tax)</p>
            <p>Total paid</p>
            <p>Balance</p>
            <p>Status</p>
          </span>
          <span>
            <p>Kes {{session.sessionDuration}}</p>
            <p>Kes {{session.amountPaid}}</p>
            <p>Kes {{session.sessionBalance}}</p>
            <div
              class="mb-1 "
              class="badge"
              [ngClass]="{
                 'badge-partial': session.sessionBalance > '0', 'badge-overpaid':session.sessionBalance < '0',
                 'badge-paid': session.sessionBalance == 0
              }"
            >
              <p *ngIf="session.sessionBalance > '0'">
                Partially paid
              </p>
              <p *ngIf="session.sessionBalance < '0'">
              Overpaid
              </p>
              <p *ngIf="session.sessionBalance == '0'">
               Fully paid
              </p>

            </div>
          </span>
        </div>
      </div>

      <p class="text-muted mt-5" *ngIf="!payments?.length">
        No payments found.
      </p>
    </div>

    <div
      class="d-none d-lg-block"
      *ngIf="currentTab === 'notifications'"
      [@fadeIn]
    >
      <table class="table">
        <thead>
          <th coslpan="1">Notification Reason</th>
          <th coslpan="1">Notification Date</th>
          <th coslpan="1">Notification Mode</th>
        </thead>
        <tbody *ngIf="notifications.length">
          <tr *ngFor="let notification of notifications">
            <td>{{ notification.subject }}</td>
            <td>{{ notification.sentAt | date : "MMM d, y " }}</td>
            <td>{{ notification.notificationMode }}</td>
            <td>
              <button
                class="btn btn-view"
                data-bs-toggle="modal"
                data-bs-target="#notificationModal"
                (click)="viewNotification(notification)"
              >
                view
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <p class="text-muted text-center" *ngIf="!notifications?.length">
        no notifications found
      </p>
    </div>

    <div class="show-ms" *ngIf="currentTab === 'notifications'" [@fadeIn]>
      <p class="text-muted mt-5" *ngIf="!notifications?.length">
        No notifications found.
      </p>
      <div *ngIf="notifications?.length">
        <div
          data-bs-toggle="modal"
          data-bs-target="#notificationModal"
          (click)="viewNotification(notification)"
          *ngFor="let notification of notifications"
          class="listing-item"
        >
          <div class="d-flex justify-content-between mb-1">
            <div>
              <p class="mb-1">{{ notification.subject }}</p>
              <p class="mb-1">{{ notification.notificationMode }}</p>
            </div>
            <span
              >{{ notification.sentAt | date : "MMM d, y " }}
              <fa-icon [icon]="rightIcon"> </fa-icon>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-md-block">
        <table class="table" *ngIf="currentTab === 'attachments'" [@fadeIn]>
          <thead>
            <th coslpan="1">Attachment No</th>
            <th coslpan="1">Attachment date</th>
            <th coslpan="1">Details</th>
          </thead>
          <tbody>
            <tr *ngFor="let attachment of attachments">
              <td>{{ attachment.refNo }}</td>
              <td>{{ attachment.amount }}</td>
              <td>{{ attachment.date }}</td>
              <td>
                <button
                  class="btn btn-view-session"
                  data-bs-toggle="modal"
                  data-bs-target="#payementModal"
                >
                  View
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="show-ms" *ngIf="currentTab === 'attachments'" [@fadeIn]>
        <div *ngFor="let attachment of attachments" class="listing-item">
          <div class="d-flex justify-content-between mb-3">
            <h4>{{ attachment.session.name }}</h4>
            <span>{{ attachment.amount }}</span>
          </div>
          <span>{{ attachment.narration }}</span>
          <h6>{{ attachment.paidAt | date: "MMM d, y " }}</h6>
        </div>
      </div>
  </div>

<!-- Record payment details form modal -->
<div
  class="bd-example-modal-lg modal fade"
  id="payementFormModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Record Payment
        </h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="paymentForm">
          <div class="mb-3">
            <label for="exampleInputEmail1">Payment Mode</label>
            <select
              formControlName="paymentType"
              class="form-select"
              id="paymentType"
            >
              <option
                [selected]="isPaymentRef"
                (click)="showPaymentRef('MPESA')"
              >
                MPESA
              </option>
              <option (click)="showPaymentRef('BANK')">BANK</option>
              <option (click)="showPaymentRef('CASH')">CASH</option>
            </select>
          </div>

          <div class="mb-3" *ngIf="isPaymentRef">
            <label for="exampleInputEmail1">Transaction ref</label>
            <input
              formControlName="extPaymentRef"
              name="extpaymentRef"
              type="text"
              class="form-control"
              id="extPaymentRef"
              aria-describedby="payment reference number"
              placeholder="Payment reference number"
            />
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1">Amount</label>
            <input
              formControlName="amount"
              name="amount"
              type="number"
              class="form-control"
              id="amount"
              aria-describedby="amount paid"
              placeholder="Amount paid"
            />
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1">Narration</label>
            <textarea
              formControlName="narration"
              name="narration"
              class="form-control"
              id="narration"
              aria-describedby="narration"
              placeholder="Payment narration"
            >
            </textarea>
          </div>
          <div class="d-flex input-group align-items-center mt-3 mb-3">
            <label for="exampleInputEmail1">Notify the client</label>
            <div class="d-flex-column justify-content-between ms-3">
              <input
                type="checkbox"
                name="cancelsession"
                checked
                [(ngModel)]="showHideMessage"
                formControlName="sendNotification"
              />
            </div>
          </div>
        </form>
        <div class="message-area" *ngIf="!showHideMessage" [@fadeIn]>
          <p class="message-sent">
            {{ session?.client?.firstName | titlecase }}, shall not be
            notified that this payment has been received :( Studies show that
            transparency improves Client retention. Tick the check box to
            improve your business' transparency.
          </p>
        </div>
        <div class="col mb-3 message-area" *ngIf="showHideMessage" [@fadeIn]>
          <p class="message-sent">
            {{ session?.client?.firstName | titlecase }}, shall receive a text
            message to show that this payment has been received :)
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="newPayment()"
        >
          Create Payment
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Payment details modal -->
<div
  class="modal fade"
  id="payementModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Payment Details
        </h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="payment">
        <div class="d-flex justify-content-between">
          <p>Ext Payment Ref</p>
          <span>{{ payment.extPaymentRef }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Mode</p>
          <span>Manual</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Amount</p>
          <span>{{ payment.amount }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Balance After:</p>
          <span>{{ payment.balanceAfter }}</span>
        </div>

        <div class="d-flex justify-content-between">
          <p>Narration</p>
          <span>{{ payment.narration }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Payment Date</p>
          <span>{{ payment.paidAt | date : "MMM d, y hh:mm a" }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Over Payment:</p>
          <span>{{ payment.overPayment }}</span>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Notification details modal -->
<div
  class="modal fade"
  id="notificationModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Notification Details
        </h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="notification">
        <div class="d-flex justify-content-between">
          <p>Notification Subject:</p>
          <span>{{ notification.subject }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Reason</p>
          <span>{{ notification.sendReason }}</span>
        </div>

        <div class="d-flex justify-content-between">
          <p>Source Address</p>
          <span>{{ notification.srcAddress }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Sent at:</p>
          <span>{{ notification.sentAt | date : "MMM d, y " }}</span>
        </div>
        <div class="d-flex-column">
          <p>Content:</p>
          <span>{{ notification.content }}</span>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- edit session modal -->
<div
  class="modal fade"
  id="editsessionModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Edit session</h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="editedsessionForm" >
          <div class="row p-2">
            <div class=" mb-3 col-md-6 ">
              <label for="name">Session Name *</label>
              <input
              formControlName="name"
              value="{{currentSessionName?.name}}"
                name="name"
                type="text"
                class="form-control"
                id="name"
                required
              />
            </div>
          <div class="row p-2">
            <div class=" mb-3 col-md-6 ">
              <label for="inputlastname">Session Details</label>
              <input 
              formControlName="details"
              value="{{currentdetails?.provider}}"
              type="text" 
              class="form-control" 
              id="inputEmail4" 
              placeholder="Enter Session Description" 
              name="details" 
              required >
            
            </div>
            <div class="mb-3 col-md-6">
              <label for="inputEmail4">Session Date</label>
              <input
              formControlName="sessionDate"
              value="{{currentSessionDate?.sessionDate}}" 
              type="date" 
              variant="success" 
              class="form-control" 
              id="inputEmail4" 
              placeholder="Date" 
              name="session_date" 
              >   
            </div>
          </div>
          <div class="row p-2">
              <div class="mb-3 col-md-6">
                <label for="inputEmail4">From</label>
                <input
                formControlName="sessionStartTime"
                value="{{currentsessionStartTime?.sessionStartTime}}" 
                type="time" 
                class="form-control" 
                id="inputEmail4" 
                placeholder="Time" 
                name="session_time_from" 
               >
                </div>
            <div class="mb-3 col-md-6">
              <label for="inputEmail4">To</label>
              <input 
              formControlName="sessionEndTime"
              value="{{currentsessionEndTime?.provider}}"
              type="time" 
              class="form-control" 
              id="inputEmail4" 
              placeholder="Time" 
              name="session_time_to" 
              >
            </div>
          </div>
          <div class="row p-2">
            <div class=" mb-3 col-md-6 ">
                <label class="form-group-text" for="clientType">Session Venue</label>
            <select 
            formControlName="sessionVenue"
            value="{{currentsessionVenue?.sessionVenue}}"
            class="form-select" 
                id="inputGroupSelect01" 
                name="session_venue" 
               >
                <option value="VIRTUAL">VIRTUAL</option>
                <option value="PHYSICAL">PHYSICAL</option>
              </select>
                </div>
                <div class="mb-3 col-md-6">
                  <label for="inputEmail4">Session Goals</label>
                  <input 
                  formControlName="goals"
                  value="{{currentgoals?.goals}}"
                  type="email" class="form-control" 
                  id="inputEmail4" placeholder="Goals" 
                  name="goals" >
                </div>
         <div class="d-flex input-group mb-3 mt-3">
          <label for="notification">Notify the client</label>
          <div class="d-flex-column justify-content-between ms-3">
            <label class="">
              <input
                type="checkbox"
                checked
                name="notification"
                [(ngModel)]="showHideMessage"
                formControlName="sendNotification"
              />
              <span class=""></span>
            </label>
          </div>
        </div> 
         <div *ngIf="!showHideMessage" [@fadeIn]>
        <p>The Client will not be notified</p>
      </div> 
        <div class="col mb-3" *ngIf="showHideMessage" [@fadeIn]>
        <div class="">
          <label for="message">Message to be sent</label>
          <p class="lead">
            "Dear {{ client?.firstName | titlecase }}. Your
            {{ sessionType }} session of amount {{ sessionDuration }} has been
            recorded. I am working to promptly have your session delivered by
            {{ sessionDate | date }}. Thank you. "
          </p>
        </div>
      </div> 
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="editedsession()"
        >
          Update session
        </button>
      </div>
    </div>
<!-- Modal for adding or editing a session -->
<div class="modal" id="sessionModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ modalTitle }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <form [formGroup]="editedsessionForm" >
            <div class="row p-2">
              <div class=" mb-3 col-md-6 ">
                <label for="name">Session Name *</label>
                <input
                formControlName="name"
                value="{{currentSessionName?.name}}"
                  name="name"
                  type="text"
                  class="form-control"
                  id="name"
                  required
                />
              </div>
            <div class="row p-2">
              <div class=" mb-3 col-md-6 ">
                <label for="inputlastname">Session Details</label>
                <input 
                formControlName="details"
                value="{{currentdetails?.provider}}"
                type="text" 
                class="form-control" 
                id="inputEmail4" 
                placeholder="Enter Session Description" 
                name="details" 
                required >
              
              </div>
              <div class="mb-3 col-md-6">
                <label for="inputEmail4">Session Date</label>
                <input
                formControlName="sessionDate"
                value="{{currentSessionDate?.sessionDate}}" 
                type="date" 
                variant="success" 
                class="form-control" 
                id="inputEmail4" 
                placeholder="Date" 
                name="session_date" 
                >   
              </div>
            </div>
            <div class="row p-2">
                <div class="mb-3 col-md-6">
                  <label for="inputEmail4">From</label>
                  <input
                  formControlName="sessionStartTime"
                  value="{{currentsessionStartTime?.sessionStartTime}}" 
                  type="time" 
                  class="form-control" 
                  id="inputEmail4" 
                  placeholder="Time" 
                  name="session_time_from" 
                 >
                  </div>
              <div class="mb-3 col-md-6">
                <label for="inputEmail4">To</label>
                <input 
                formControlName="sessionEndTime"
                value="{{currentsessionEndTime?.provider}}"
                type="time" 
                class="form-control" 
                id="inputEmail4" 
                placeholder="Time" 
                name="session_time_to" 
                >
              </div>
            </div>
            <div class="row p-2">
              <div class=" mb-3 col-md-6 ">
                  <label class="form-group-text" for="clientType">Session Venue</label>
              <select 
              formControlName="sessionVenue"
              value="{{currentsessionVenue?.sessionVenue}}"
              class="form-select" 
                  id="inputGroupSelect01" 
                  name="session_venue" 
                 >
                  <option value="VIRTUAL">VIRTUAL</option>
                  <option value="PHYSICAL">PHYSICAL</option>
                </select>
                  </div>
                  <div class="mb-3 col-md-6">
                    <label for="inputEmail4">Session Goals</label>
                    <input 
                    formControlName="goals"
                    value="{{currentgoals?.goals}}"
                    type="email" class="form-control" 
                    id="inputEmail4" placeholder="Goals" 
                    name="goals" >
                  </div>
<div class="modal-footer">
<button type="submit" class="btn btn-primary">Save</button>
<button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
</div>
<!-- Edit Payment details modal -->
<div
  class="modal fade"
  id="editPaymentModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Edit Payment Details
        </h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="payment">
        <form [formGroup]="editPaymentForm">
          <div class="mb-3 form-group">
            <label for="exampleInputEmail1">Transaction RefNo</label>
            <input
              formControlName="extPaymentRef"
              name="extPaymentRef"
              type="text"
              class="form-control"
              id="extPaymentRef"
              aria-describedby="transaction refNo"
              value="{{ payment.extPaymentRef }}"
            />
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Amount </label>
            <input
              formControlName="amount"
              name="amount"
              type="text"
              class="form-control"
              id="amount"
              aria-describedby="payment amount"
              value="{{ payment.amount }}"
            />
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Balance after </label>
            <input
            formControlName="balanceAfter"
            name="balanceAfter"
            type="text"
            class="form-control"
            id="balanceAfter"
            aria-describedby="balance amount"
            value="{{ payment.balanceAfter }}"
          />
          </div> 
          <!-- <div class="form-group">
            <label for="exampleInputEmail1">Payment date </label>
            <input
            formControlName="paymentDate"
            name="paymentDate"
            type="text"
            class="form-control"
            id="paymentDate"
            aria-describedby="payment amount"
            value="{{ payment.paidAt | date : 'MMM d, y hh:mm a' }}"
          />
          </div>
          <div class="form-group">
            <label for="exampleInputEmail1">Narration</label>
            <textarea
              formControlName="narration"
              name="narration"
              class="form-control"
              id="editNarration"
              aria-describedby="narration"
              placeholder="Edited Payment narration"
            >
            </textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Close
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
          (click)="updatePaymentDetails()"
        >
          Update
        </button>
      </div>
    </div>
  </div>
</div>-->

<!-- Confirm session modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="confirmsessionModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Confirm session</h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="session">
        <div class="d-flex justify-content-between">
          <p>Client Name</p>
          <span>{{
            session.client.firstName + " " + session.client.lastName
              | titlecase
          }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Product</p>
          <span>{{ session.details }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Session Type</p>
          <span>{{ session.sessionType }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount</p>
          <span>{{ session.sessionDuration }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount Paid</p>
          <span>{{ session.amountPaid }}</span>
        </div>

        <form [formGroup]="confirmSessionForm">
          <div class="mb-3">
            <label for="exampleInputEmail1">narration</label>
            <textarea
              formControlName="narration"
              name="narration"
              class="form-control"
              id="narration"
              aria-describedby="narration"
              placeholder="narration for confirming the session"
            >
            </textarea>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <label for="exampleInputEmail1">notify the client</label>
            <div class="toggle">
              <label class="switch">
                <input type="checkbox" name="cancelsession" checked />
                <span class="slider round"></span>
              </label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="confirmSession()"
        >
          Submit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delivered session modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="deliveredsessionModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Conducted session
        </h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="session">
        <div class="d-flex justify-content-between">
          <p>Client Name</p>
          <span>{{
            session.client.firstName + " " + session.client.lastName
              | titlecase
          }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Product</p>
          <span>{{ session.details }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Session Type</p>
          <span>{{ session.sessionType }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount</p>
          <span>{{ session.sessionDuration }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount Paid</p>
          <span>{{ session.amountPaid }}</span>
        </div>
        <form [formGroup]="deliveredSessionForm">
          <div class="mb-3">
            <label for="exampleInputEmail1">Conducted  On</label>
            <input
              formControlName="deliveredOn"
              [(ngModel)]="sessionDate"
              name="deliveredOn"
              type="date"
              class="form-control"
              id="deliveredOn"
              aria-describedby="emailHelp"
              placeholder="Delivered On Date"
            />
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1">Time</label>
            <input
              formControlName="deliveredOn"
              [(ngModel)]="sessionStartTime"
              name="deliveredtime"
              type="time"
              class="form-control"
              id="deliveredtime"
              aria-describedby="emailHelp"
              placeholder="Delivery time"
            />
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1">narration</label>
            <textarea
              formControlName="goals"
              name="narration"
              class="form-control"
              id="narration"
              aria-describedby="narration"
              placeholder="narration for delivering the session"
            >
            </textarea>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <label for="exampleInputEmail1">Notify the client</label>
            <div class="toggle">
              <label class="switch">
                <input type="checkbox" name="cancelsession" checked />
                <span class="slider round"></span>
              </label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="ConductedSession()"
        >
          Submit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cancel session modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="cancelsessionModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Cancel session</h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="session">
        <div class="d-flex justify-content-between">
          <p>Client Name</p>
          <span>{{
            session.client.firstName + " " + session.client.lastName
              | titlecase
          }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Balance</p>
          <span>{{ session.sessionBalance }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Session Type</p>
          <span>{{ session.sessionType }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Duration</p>
          <span>{{ session.sessionDuration }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount Paid</p>
          <span>{{ session.amountPaid }}</span>
        </div>
        <form [formGroup]="cancelSessionForm">
          <div class="mb-3">
            <label for="exampleInputEmail1">narration</label>
            <textarea
              formControlName="narration"
              name="narration"
              class="form-control"
              id="narration"
              aria-describedby="narration"
              placeholder="narration for cancelling the session"
            >
            </textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="cancelSession()"
        >
          Submit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete session modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="deletesessionModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Delete session</h1>

        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="session">
        <div class="d-flex justify-content-between">
          <p>Client Name</p>
          <span>{{
            session.client.firstName + " " + session.client.lastName
              | titlecase
          }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Balance</p>
          <span>{{ session.sessionBalance }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Session Type</p>
          <span>{{ session.sessionType }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount</p>
          <span>{{ session.sessionDuration }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount Paid</p>
          <span>{{ session.amountPaid }}</span>
        </div>
        <form [formGroup]="deleteSessionForm">
          <div class="mb-3">
            <label for="exampleInputEmail1">narration</label>
            <textarea
              formControlName="narration"
              name="narration"
              class="form-control"
              id="narration"
              aria-describedby="narration"
              placeholder="narration for deleting the session"
            >
            </textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="deleteSession()"
        >
          Submit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Send payment reminder modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="paymentReminderModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Payment reminder
        </h1>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" *ngIf="session">
        <div class="d-flex justify-content-between">
          <p>Client Name</p>
          <span>{{
            session.client.firstName + " " + session.client.lastName
              | titlecase
          }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Product</p>
          <span>{{ session.details }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>Session Type</p>
          <span>{{ session.sessionType }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount</p>
          <span>{{ session.sessionDuration }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Amount Paid</p>
          <span>{{ session.amountPaid }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <p>session Balance</p>
          <span>{{ session.sessionBalance }}</span>
        </div>
        <div class="">
          <p class="message-title mb-2">
            The message below will be sent to
            {{ session.client.firstName | titlecase }}.
          </p>
        </div>
        <div class="message-area">
          <p class="message-sent">
            "Dear {{ this.session?.client.firstName }} please pay the balance
            of, Ksh.{{ this.session?.sessionBalance }}, for session
            {{ this.session.sessionNumber }} by,
            {{ this.session?.dueDate | date : "MMM d, y " }}. Thank you,
            {{ this.session?.coach.businessName }}
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-submit"
          data-bs-dismiss="modal"
          (click)="sendReminder()"
        >
          Send
        </button>
      </div>
    </div>
  </div>





<!-- invoice modal -->
<div class="modal fade" id="invoicemodal" tabindex="-1" role="dialog" aria-labelledby="receiptModal" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">

    <div class="modal-body" id="invoice">
      <div class="m-2" >
        <img class="welcome-img mb-3" src="../../../assets/images/Logo.png" />

        <div class="client-details" *ngIf="!loadingsession && session"  [@fadeIn]>
          <div class="d-flex justify-content-between">
            <span class="title">session No</span>
            <span class="value">{{ session.sessionNumber }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Client name</span>
            <span class="value">{{
              session.client.firstName + " " + session.client.lastName
                | titlecase
            }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Session type</span>
            <span class="value">{{ session.sessionType }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Session date</span>
            <span class="value">{{ session.sessionDate | date : "MMM d, y " }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Status</span>
            <span class="value">
              <span
                class="badge"
                [ngClass]="{
                  'badge-warning': session.sessionStatus === 'CONDUCTED',
                  'badge-success': session.sessionStatus === 'CONFIRMED',
                  'badge-danger': session.sessionStatus === 'CANCELLED',
                  'badge-primary': session.sessionStatus === 'NEW'
                }"
                >{{ session.sessionStatus }}</span
              >
            </span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">session amount</span>
            <span class="value">{{ session.sessionDuration }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Amount paid</span>
            <span class="value">{{ session.amountPaid }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Product</span>
            <span class="value">{{ session.details }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="title">Session Venue</span>
            <span class="value">{{ session.sessionVenue }}</span>
          </div>

        </div>

      </div>

    </div>
    <div class="modal-footer">
      <button type="button" class="close btn-secondary" data-bs-dismiss="modal">Close</button>
      <button
    class="download btn-add"
    (click)="savePdf()"
  >
  <i class="fa fa-download"></i>
    Download
  </button>
    </div>
  </div>
</div>
</div>

